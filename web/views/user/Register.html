<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		#parse('pagelet/IndexHeader.html')
		<style>
			#footer{
				position:fixed;
				left:0;
				bottom:0;
				width:100%;
			}
			label{
				font-weight: normal;
				color: red;
				margin-bottom: 0;
				display: none;
		    }
		</style>
	</head>
	<body>
		#parse('pagelet/TopBanner.html')

		<header id="header"></header>
		<section class="container">
		    <div class="row">		    
				<div class="col-md-3 col-sm-4">
					<h3>新用户注册</h3>
					<div id="alert_info" class="alert alert-warning">
						<button type="button" class="close" data-dismiss="alert">&times;</button>
						<strong>提示：</strong><span id='alert_msg'>请按要求输入正确的格式内容。</span>
					</div>
					<form id="regFrm" role="form" onsubmit="return false;">
						<div class="form-group">
							<input type="text" id="regFrm_UserName" name="UserName" class="form-control" placeholder="用户名">
						</div>
						<div class="form-group">
							<input type="text" id="regFrm_Email" name="Email" class="form-control" placeholder="电子邮箱">
						</div>
						<div class="form-group">
							<input type="password" id="regFrm_UserPass" name="UserPass" class="form-control" placeholder="密码">
						</div>
						<div class="form-group">
							<input type="password" id="regFrm_UserPass2" class="form-control" placeholder="密码确认">
						</div>
                        <button id="btn_reg" type="button" class="btn btn-primary">注册</button>
                        <a class="btn btn-danger" href="login">登陆</a>
                    </form>                
                </div>
		    </div>
		</section>

        #parse('pagelet/IndexFooter.html')
        #parse('pagelet/IndexJs.html')
        <script type="text/javascript">var exports = {};</script>
		<script type="text/javascript" src="../public/user/regFrm.js" lang='utf-8'></script>

		<!-- Own -->
		<script type="text/javascript">
			$(function(){

				$('#btn_reg').click(function(){
					var formObj = $("#regFrm").serializeObjectForm();
					var valiResu = valiUserRegFrm(formObj);
					if(valiResu){
						if('string' === typeof valiResu){
							$('#alert_msg').html(valiResu);
						}else{
							$('#alert_msg').html(valiResu[0]);
							$('#regFrm_'+ valiResu[1]).focus();
						}
						return;
					}

					$.ajax({
						url: '/user/register',
						type: "POST",
						dataType: "json",
						data: {
							data: JSON.stringify(formObj)
						}
					}).done(function(responseText) {
						var msg, lab;
						if(responseText.success){
							location.href = formObj.UserName +'/register/success';
						}else{
							msg = responseText.msg;
							if(msg.message) return $('#alert_msg').html(msg.message);

							if('string' === msg) return $('#alert_msg').html(msg);

							$('#alert_msg').html(msg[0]);

							lab = $('#regFrm_'+ msg[1]);
							if(lab[0]) lab.focus();
						}
					}).complete(function(){
					});
				});
			});
		</script>
	</body>
</html>